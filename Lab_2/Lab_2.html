<!DOCTYPE html>
<html lang="pt">
<head>
<title>Lab 02 - Calibração de Cameras</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
* {
    box-sizing: border-box;
}

body {
  font-family: Arial, Helvetica, sans-serif;
}

header {
  background-color: #6a8d3c;
  padding: 10px;
  text-align: center;
  font-size: 35px;
  color: white;
}

section {
  display: -webkit-flex;
  display: flex;
}

nav {
  -webkit-flex: 1;
  -ms-flex: 1;
  flex: 1;
  background: #ccc;
  padding: 20px;
}

nav ul {
  list-style-type: none;
  padding: 0;
}

article {
  -webkit-flex: 3;
  -ms-flex: 3;
  flex: 3;
  background-color: #f1f1f1;
  padding: 12px;
}

footer {
  background-color: #708090;
  padding: 10px;
  text-align: center;
  color: white;
}

.code-box {
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            padding: 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre;
            width: 800px; 
            margin: 0 auto; 
            overflow-x: auto; 
}

figcaption {
    font-size: 14px;
    color: #555;
    margin-top: 5px;
}

table {
            width: 50%;
            border-collapse: collapse;
            margin: 20px auto;
}

th, td {
    border: 1px solid #000;
    padding: 8px;
    text-align: center;
}

th {
    background-color: #f2f2f2;
}

@media (max-width: 600px) {
  section {
    -webkit-flex-direction: column;
    flex-direction: column;
  }
}
</style>
</head>
<body>

<header>
    <h1>ESZA019-17SA - Visão Computacional</h1>
    <h3>Lab 02 - Calibração de Cameras</h3>
    <h5>Integrantes
    <br>Diego Aoyagi de Souza - RA: 11066516
    <br>Gabriel Gomes de Oliveira - RA: 11108214
    <br>Gustavo Cardoso Bezerra- RA: 11201822553</h5>
    <h6>Data do Experimento: 02/07/2024
    <br>Data de publicação: 16/07/2024</h6>
</header>

<section>  
  <article> <!-- Texto central que indica a introdução do laboratório em questão-->
    <h2><center>Introdução</center></h2>
    <p><justify>
        A calibração de câmeras desempenha um papel fundamental na visão computacional, garantindo que as imagens capturadas sejam precisas e confiáveis ​​para análise e medição. Ao empregar conceitos como coordenadas homogêneas e matrizes de transformação, podemos entender como pontos no espaço 3D são projetados no plano 2D da imagem. Essa transformação é essencial para aplicações que exigem precisão, como reconstrução 3D, medições de distância e reconhecimento de objetos.
      
        <br>O OpenCV, uma biblioteca amplamente utilizada para visão computacional, oferece ferramentas robustas para a calibração de câmeras. Utilizando padrões conhecidos, como tabuleiros de xadrez, é possível capturar imagens e determinar automaticamente os parâmetros intrínsecos da câmera (como distância focal e ponto principal) e os parâmetros extrínsecos (posição e orientação da câmera em relação ao ambiente). Essa calibração não apenas corrige distorções ópticas, como também permite a medição precisa de objetos nas imagens, beneficiando desde sistemas de monitoramento e realidade aumentada até a automação industrial. A calibração de câmeras utilizando o OpenCV é realizada seguindo um processo sistemático que envolve captura de imagens, detecção de pontos de calibração em um padrão conhecido (como um tabuleiro de xadrez), e cálculo dos parâmetros intrínsecos e extrínsecos da câmera.

    </justify></p>


    <br>
    <h2><center>Procedimentos experimentais</center></h2>
    <p><justify>
        Antes de iniciar o procedimento experimental, é crucial possuir um embasamento teórico sólido sobre o tema. Para isso, realizamos uma leitura dos conteúdos digitais a respeito dos temas necessários presentes nas referências bibliográficas. Isso nos permite compreender e aplicar de maneira eficaz os conceitos fundamentais durante a parte experimental, utilizando ferramentas digitais como suporte. Em seguida, utilizamos o roteiro disponibilizado, sendo este separado em três partes principais.
        <br><br>
        
        <b>Passo 1 - Imagens Disponibilizadas:</b> Na pasta “Documentos” criamos uma pasta chamada “Lab2” contendo todos os arquivos disponibilizados para essa atividade. Utilizando as imagens disponibilizadas e a programação fornecida, foram feitos ajustes de acordo com o necessário para que o programa fosse executado de forma correta.
        <br>
        <p><center><img src="imagem_1.png" width="642" height="578" alt="Imagem de exemplo disponibilizada no roteiro"></center></p>
        <center><figcaption>Figura 1: Imagem de exemplo disponibilizada no roteiro.</figcaption><p></center>
        <br>
        Para a primeira captura de parâmetros, foi utilizado o código disponibilizado e nele foi necessário alterar o local de leitura das imagens fornecendo o endereço da pasta. Através do prompt devemos entrar no ambiente CV24 para executar o arquivo “L2_cal.py”, onde obtivemos os seguintes resultados para as imagens disponibilizadas:
        <p><center><img src="imagem_4.png" alt="Resultados"></center></p>
        <p><center><img src="imagem_5.png" alt="Resultados"></center></p>
        <p><center><img src="imagem_6.png" alt="Resultados"></center></p>
        <p><center><img src="imagem_7.png" alt="Resultados"></center></p>
        <center><figcaption>Figura 2: Resultados do passo 1 - item A do roteiro.</figcaption><p></center>
        <br>

        <b>Passo 2 - WebCAM:</b> No segundo passo, vamos repetir o mesmo procedimento porém agora utilizando o segundo arquivo “L2_chess.py” que condiciona a capturar as imagens  de uma folha quadriculada similar a um tabuleiro de xadrez. Com imagens capturadas durante o laboratório através de diversos ângulos de distorção com a webcam fornecida, foram capturadas 14 imagens conforme o passo anterior.
        <br>
        <p><center><img src="imagem_2.png" width="642" height="578" alt="Figura 3: Imagem capturada com a WebCAM."></center></p>
        <center><figcaption>Figura 3: Imagem capturada com a WebCAM.</figcaption><p></center>
        <br>
        Para a execução correta do arquivo foi necessário fazer a modificação do script nos parâmetros de linha e colunas para [6,8] conforme o tabuleiro utilizado em laboratório. Os resultados obtidos para a calibração da webcam foram registrados a seguir:
        <p><center><img src="imagem_8.png" alt="Resultados"></center></p>
        <p><center><img src="imagem_9.png" alt="Resultados"></center></p>
        <p><center><img src="imagem_10.png" alt="Resultados"></center></p>
        <p><center><img src="imagem_11.png" alt="Resultados"></center></p>
        <center><figcaption>Figura 3: Resultados do passo 2 - item B do roteiro.</figcaption><p></center>
        <br>

        <b>Passo 3 - Imagens do Celular:</b> Posteriormente foi executado o mesmo procedimento do passo 2, porém com imagens tiradas de uma câmera de celular.
        <br>
        <p><center><img src="imagem_3.png" width="801" height="649" alt="Figura 4: Imagem capturada com celular."></center></p>
        <center><figcaption>Figura 4: Imagem capturada com celular.</figcaption><p></center>
        <br>
        Os valores das matrizes obtidas estão exemplificados abaixo:
        <p><center><img src="imagem_12.png" alt="Resultados"></center></p>
        <p><center><img src="imagem_13.png" alt="Resultados"></center></p>
        <p><center><img src="imagem_14.png" alt="Resultados"></center></p>
        <p><center><img src="imagem_15.png" alt="Resultados"></center></p>
        <center><figcaption>Figura 5: Resultados do passo 3 - item C do roteiro.</figcaption><p></center>
        <br>
    </justify></p>

    <br>
    <h2><center>Análise e discussão dos estudos realizados</center></h2>
    <p><justify>
      Para melhor visualização foram construídas as matrizes e parâmetros obtidos.
      <br><br>
      <b>Valores Obtidos do ensaio com imagens disponibilizadas:</b>
        <ul>
          <li>Matriz de parâmetros internos:</li>
        </ul>
        <table>
          <tr>
            <td>536,07343567</td>
            <td>0,00000000</td>
            <td>342,37038373</td>
          </tr>
          <tr>
            <td>0,00000000</td>
            <td>536,01635124</td>
            <td>235,53685496</td>
          </tr>
          <tr>
            <td>0,00000000</td>
            <td>0,00000000</td>
            <td>1,00000000</td>
          </tr>
        </table>
        
        <ul>
          <li>Coeficientes de Distorção:</li>
        </ul>
        <table>
          <tr><td>-0,2650901200</td></tr>
          <tr><td>-0,0467434600</td></tr>
          <tr><td>0,0018330100</td></tr>
          <tr><td>-0,00031472</td></tr>
          <tr><td>0,25231495</td></tr>
        </table>

        <b>Valores obtidos do ensaio com a webcam disponibilizada:</b>
        <ul>
          <li>Matriz de parâmetros internos:</li>
        </ul>
        <table>
          <tr>
            <td>688,20880759</td>
            <td>0,00000000</td>
            <td>311,08492406</td>
          </tr>
          <tr>
            <td>0,00000000</td>
            <td>688,49441805</td>
            <td>240,18630357</td>
          </tr>
          <tr>
            <td>0,00000000</td>
            <td>0,00000000</td>
            <td>1,00000000</td>
          </tr>
        </table>

        <ul>
          <li>Coeficientes de Distorção:</li>
        </ul>
        <table>
          <tr><td>0,0012608793</td></tr>
          <tr><td>0,6249667700</td></tr>
          <tr><td>0,0024695340</td></tr>
          <tr><td>-2,71088582</td></tr>
          <tr><td>-3,02573319</td></tr>
        </table>

        <b>Valores obtidos do ensaio com a câmera de celular:</b>
        <ul>
          <li>Matriz de parâmetros internos:</li>
        </ul>
        <table>
          <tr>
            <td>1211,3794300000</td>
            <td>0,00000000</td>
            <td>794,1793380000</td>
          </tr>
          <tr>
            <td>0,00000000</td>
            <td>1212,2526600000</td>
            <td>602,9027460000</td>
          </tr>
          <tr>
            <td>0,00000000</td>
            <td>0,00000000</td>
            <td>1,00000000</td>
          </tr>
        </table>

        <ul>
          <li>Coeficientes de Distorção:</li>
        </ul>
        <table>
          <tr><td>0,1913107260</td></tr>
          <tr><td>-0,7668595600</td></tr>
          <tr><td>0,0006120623</td></tr>
          <tr><td>0,0025276552</td></tr>
          <tr><td>1,15920908</td></tr>
        </table>
        <br>
        Em comparação com as outras fontes de captura utilizadas temos que a imagem pré fornecida para o relatório é a que possui menores parâmetros de distorção em relação às capturas executadas em laboratório, tanto da webcam quanto da câmera do celular utilizado. Conhecendo agora os coeficientes de distorção  podemos usar uma função do OpenCV que utiliza esses parâmetros como entrada para reparar a imagem distorcida.
    </justify></p>
    
    <br>
    <h2><center>Conclusão</center></h2>
    <p><justify>
      A calibração de câmera é o processo de determinar os parâmetros intrínsecos e extrínsecos necessários para relacionar de forma precisa um ponto 3D no espaço real com sua projeção 2D na imagem capturada pela câmera calibrada. Os parâmetros intrínsecos incluem características como o comprimento focal da lente, o centro óptico e os coeficientes de distorção radial, enquanto os parâmetros extrínsecos referem-se à orientação da câmera em relação a um sistema de coordenadas global.
      Tabuleiros de xadrez são amplamente preferidos para calibração de câmera devido à sua distinção visual e facilidade de detecção automática em imagens. Seus cantos quadrados são especialmente vantajosos para localização precisa, devido aos gradientes nítidos que se formam em duas direções perpendiculares. Esses cantos são identificados na interseção das linhas do tabuleiro, facilitando a extração dos pontos de interesse.
      Para encontrar a projeção de um ponto 3D no plano da imagem, é necessário primeiro transformar suas coordenadas do sistema de coordenadas global para o sistema de coordenadas da câmera, utilizando os parâmetros extrínsecos. Em seguida, aplicando os parâmetros intrínsecos da câmera, projetamos o ponto no plano da imagem.
      O objetivo final da calibração é derivar a matriz intrínseca da câmera, a matriz de rotação e o vetor de translação, utilizando um conjunto conhecido de pontos 3D e suas correspondentes coordenadas 2D nas imagens. Uma vez obtidos esses parâmetros, consideramos a câmera calibrada.
      Em resumo, o algoritmo de calibração de câmera requer como entrada uma coleção de imagens contendo pontos cujas coordenadas 2D na imagem e 3D no espaço real são conhecidas. Como saída, ele fornece a matriz intrínseca da câmera, além da rotação e translação para cada imagem. Portanto, uma vez executado o algoritmo de calibração de câmeras e obtendo os parâmetros internos, vetores de translação e rotação e seus coeficientes de distorção, podemos aplicar a diversas imagens com intuito de sanar distorções.
    </justify></p>

    <br>
    <h2><center>Referências</center></h2>
        <p><justify><center>
              ANALYTICAL, C. N. S. Curso OpenCV Python - português. Disponível em: http://www.youtube.com/playlist?list=PLsyobOqUhkthjvmA_s7tTjb7V2EiwYYGC. Acesso em: 02 jul. 2024.
          <br>MALLICK, S. Geometry of image formation. Disponível em: https://learnopencv.com/geometry-of-image-formation. Acesso em: 02 jul. 2024.
          <br>OpenCV: Getting started with images. Disponível em: https://docs.opencv.org/4.x/db/deb/tutorial_display_image.html. Acesso em: 02 jul. 2024.
          <br>OpenCV: Getting started with videos. Disponível em: https://docs.opencv.org/4.x/dd/d43/tutorial_py_video_display.html. Acesso em: 02 jul. 2024.
          <br>OpenCV: OpenCV-Python Tutorials. Disponível em: https://docs.opencv.org/master/d6/d00/tutorial_py_root.html. Acesso em: 02 jul. 2024.
          <br>SADEKAR, K. Camera calibration using OpenCV. Disponível em: https://learnopencv.com/camera-calibration-using-opencv. Acesso em: 02 jul. 2024.
        </center></justify></p>

  </article>
</section>

<footer>
  <p>2º Quadrimestre 2024</p>
</footer>

</body>
</html>